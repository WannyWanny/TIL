# Network
### Network에 대한 개념을 정리한 파일입니다.
--------------------------

## VPC(Virtual Private Cloud)
일종의 가상의 네트워크 공간. 워크로드에 대한 논리적 격리를 제공한다(ex. 개발과 테스트 공간).
- AWS 계정 전용 가상 네트워크
- IPv4 또는 IPv6 주소 범위에 존재
- 점유 리소스에 대한 특정 CIDR 범위를 생성할 수 있음
- 인바운드 및 아웃바운드 트래픽에 대한 엄격한 액세스 규칙을 제공

VPC는 리전 중 1개에 배포되며 리전 내 모든 AZ에 있다. 
하나의 VPC를 사용하는 사례는 매우 제한적. 대부분 사례에서는 대규모 조직 및 여러 IT 팀이 있는 조직에서 사용. 
VPC는 하나의 리전에 5개까지 생성가능. 물론 요청하면 더 늘릴수는 있음.

CIDR 표기법 설명: 낭비되는 IP대역폭을 막기위해 IP를 나눠서 포트번호를 지정. <- 중요하므로 추후 설명

0:NW, 1:VPL Router, 2:DNS, 3:(비워둠), 255:Broad Cast => AWS는 각 서브넷에서 5개의 IP 주소를 예약함.

- 퍼블릿 서브넷
  - 퍼블릭 인터넷에 대한 인바운드/아웃바운드 액세스를 지원하도록 인터넷 게이트웨이에 대한 라우팅 테이블 항목을 포함
  - VPC의 인스턴스와 인터넷 간에 통신을 허용하는것이 게이트웨이. 사용자는 VPC안에 게이트웨이를 통해 퍼블릭IP에 접속 가능.
- 프라이빗 서브넷
  - NAT 게이트웨이: 프라이빗 서브넷의 인스턴스가 인터넷 또는 다른 AWS 서비스로의 아웃바운드 트래픽을 시작하도록 활성화
  - NAT 게이트웨이가 외부에서 들어오는 요청을 차단

서브넷을 이상적인 구성방법은 AZ당 퍼블릭 하나, 프라이빗 하나. 웬만하면 프라이빗에 IP를 할당하자. 

퍼블릭 IP는 랜덤하며 중지 후 시작하면 IP가 바뀜 -> 단점을 극복한게 탄력적 IP. 다만 비용이 추가로 듦


보안그룹의 규칙은 상태저장. (들어왔을 때 ok이면 나갈때 검사를 안함)
보안그룹을 체인 다이어그램을 통해 관리.

                   VPC
인터넷 게이트웨이 -> 라우팅 테이블->네트워크 ACL->서브넷->SG->EC2 인스턴스
                  <- 라우팅 테이블<-네트워크 ACL<-서브넷<-SG<-EC2 인스턴스
                  
VPN과 DX를 통해 구성하는 것이 Active Stand By

일반적으로 VPC간의 데이터 통신을 할수없지만 피어링 연결을 통해 동일한 네트워크에 있는 것 처럼 통신 가능.

ELB: 수신되는 애플리케이션 트래픽을 여러 EC2 인스턴스, 컨테이너 및 IP 주소에 걸쳐 분산하는 관리형 로드 밸런싱 서비스

                ALB       |    NLB    | CLB(중요)
Protocol |  HTTP, HTTPS  |  TCP, UDP  |   HTTPS, TCP/UDP
Target   |  EC2, IP, Lambda | EC2, IP |   X
Alias    |      O       |       O     |   X

#### IAM

AWS를 이용할 때 Account가 최상의 보안. IAM을 통해 인증과 인가가 가능함. User에서는 인증을, Policy에서는 인가를 한다. 

명시적 Deny > 명시적 Allow > 묵시적 Deny

역할을 이용하면 EC2가 다른 작업을 수행 가능함. Trust Relationship이여야 가능함.
